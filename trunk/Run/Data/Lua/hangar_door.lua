Hangar_Door = {}
-------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------
-- Constants  !!!! ------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------

Hangar_Door["Time"]       = 0
Hangar_Door["Open Time"]  = 60
Hangar_Door["Open Heigh"] = 2.3
Hangar_Door["Open Speed"] = Hangar_Door["Open Heigh"] / Hangar_Door["Open Time"]


-------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------
-- States  !!!! ---------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------

State_Hangar_Porta_Closed  = {}
State_Hangar_Porta_Opening = {}
State_Hangar_Porta_Open    = {}

-------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------
-- Closed  !!!! ---------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------
State_Hangar_Porta_Closed['Enter'] = function(_entitat)

end

-------------------------------------------------------------------------------------------------
State_Hangar_Porta_Closed['Exit'] = function(_entitat)
  
end

-------------------------------------------------------------------------------------------------
State_Hangar_Porta_Closed['Update'] = function(_entitat, _dt)

end

-------------------------------------------------------------------------------------------------
State_Hangar_Porta_Closed['Receive'] = function(_entitat, _event)
  if _event.msg == Event.obrir then
    --log('OPEN RECEIVED')
    _entitat:get_component(BaseComponent.state_machine):get_state_machine():change_state('State_Hangar_Porta_Opening')
    return
  end
  
end

-------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------
-- Opening  !!!! --------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------
State_Hangar_Porta_Opening['Enter'] = function(_entitat)

  --Inicialitzem la porta posant-li un component de moviment
  --ComponentMovement.add_to_entity(_entitat)
  
  --log('OPENING')
  Hangar_Door["Time"] = 0
  
  --TODO: so alarma
end

-------------------------------------------------------------------------------------------------
State_Hangar_Porta_Opening['Exit'] = function(_entitat)
  --TODO: Pausar alarma
end

-------------------------------------------------------------------------------------------------
State_Hangar_Porta_Opening['Update'] = function(_entitat, _dt)
  local physx = _entitat:get_component(BaseComponent.physx_actor)
  local position = physx:get_position()
  
  Hangar_Door["Time"] = Hangar_Door["Time"] + _dt
  
  physx:set_position(Vect3f(position.x, position.y + Hangar_Door["Open Speed"] * _dt, position.z))
  
  --TODO: Rotar llums emergencia
  
  if Hangar_Door["Time"] >= Hangar_Door["Open Time"] then
    _entitat:get_component(BaseComponent.state_machine):get_state_machine():change_state('State_Hangar_Porta_Open')
    return
  end
end

-------------------------------------------------------------------------------------------------
State_Hangar_Porta_Opening['Receive'] = function(_entitat, _event)
  
end

-------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------
-- Open  !!!! -----------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------
-------------------------------------------------------------------------------------------------
State_Hangar_Porta_Open['Enter'] = function(_entitat)
  --TODO: El que es vulgui fer al final de nivell
end

-------------------------------------------------------------------------------------------------
State_Hangar_Porta_Open['Exit'] = function(_entitat)
  
end

-------------------------------------------------------------------------------------------------
State_Hangar_Porta_Open['Update'] = function(_entitat, _dt)

end

-------------------------------------------------------------------------------------------------
State_Hangar_Porta_Open['Receive'] = function(_entitat, _event)
  
end